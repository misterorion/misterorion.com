{"version":3,"file":"webpack.config.js","names":["crypto","require","fs","path","dotenv","CoreJSResolver","CacheFolderResolver","store","actions","getPublicPath","debug","reporter","apiRunnerNode","FRAMEWORK_BUNDLES","module","exports","program","directory","suppliedStage","port","parentSpan","fastRefreshPlugin","modulesThatUseGatsby","getGatsbyDependents","directoryPath","withBasePath","stage","rules","loaders","plugins","createWebpackUtils","assetPrefix","pathPrefix","trailingSlash","getState","config","publicPath","isPartialHydrationEnabled","process","env","GATSBY_PARTIAL_HYDRATION","processEnv","defaultNodeEnv","nodeEnv","NODE_ENV","configEnv","GATSBY_ACTIVE_ENV","envFile","join","cwd","parsed","parse","readFileSync","encoding","err","code","error","target","envObject","Object","keys","reduce","acc","key","JSON","stringify","gatsbyVarObject","match","PUBLIC_DIR","BUILD_STAGE","CYPRESS_SUPPORT","GATSBY_QUERY_ON_DEMAND","GATSBY_SOCKET_IO_DEFAULT_TRANSPORT","mergedEnvVars","assign","getOutput","filename","pathinfo","GATSBY_WEBPACK_PUBLICPATH","devtoolModuleFilenameTemplate","info","resolve","absoluteResourcePath","replace","crossOriginLoading","ROUTES_DIRECTORY","chunkFilename","library","type","withTrailingSlash","Error","getEntry","hasES6ModuleSupport","commons","polyfill","GATSBY_EXPERIMENTAL_DEV_SSR","app","getPlugins","configPlugins","moment","define","__BASE_PATH__","prefixPaths","__PATH_PREFIX__","__ASSET_PREFIX__","__TRAILING_SLASH__","BROWSER_ESM_ONLY","virtualModules","BabelConfigItemsCacheInvalidatorPlugin","GATSBY_WEBPACK_LOGGING","split","includes","WebpackLoggingPlugin","verbose","filter","Boolean","concat","fastRefresh","ForceCssHMRForEdgeCases","hotModuleReplacement","noEmitOnErrors","StaticQueryMapper","push","extractText","extractStats","isCustomEslint","hasLocalEslint","eslint","eslintRequired","PartialHydrationPlugin","provide","fetch","getDevtool","getMode","getModule","configRules","test","byDependency","esm","fullySpecified","descriptionData","js","yaml","fonts","images","media","miscAssets","use","loader","dependencies","oneOf","cssModules","css","null","getPackageRoot","pkg","dirname","getResolve","extensions","alias","gatsby$","$virtual","getAbsolutePathForVirtualModule","profile","getResolveLoader","root","userLoaderDirectoryPath","statSync","isDirectory","modules","__dirname","name","context","entry","output","devtool","performance","hints","mode","resolveLoader","isCssModule","optimization","splitChunks","chunks","cacheGroups","default","defaultVendors","framework","RegExp","priority","enforce","styles","minimize","mangleExports","componentsCount","components","size","lib","identifier","hash","createHash","libIdent","update","digest","substring","minChunks","reuseExistingChunk","Math","max","shared","chunkGraph","chunk","getModuleChunksIterable","canBeInitial","maxAsyncRequests","Infinity","maxInitialRequests","minSize","runtimeChunk","minimizer","noUglify","minifyJs","terserOptions","keep_classnames","keep_fnames","minifyCss","shouldMarkPackagesAsExternal","shouldGenerateEngines","shouldTrackBuiltins","externalsPresets","node","externals","userExternalList","checkItem","item","request","callback","resolver","dependencyType","some","newRequest","builtinModulesToTrack","builtinsExternalsDictionary","builtinModules","builtinModule","unshift","cacheLocation","cacheConfig","buildDependencies","__filename","flattenedPlugins","plugin","nodeAPIs","map","resolvedCompiledGatsbyNode","cache","dispatch","replaceWebpackConfig","getConfig","webpack","fastRefreshIncludes","babelLoaderLoc","rule","ruleLoaders","Array","isArray","useEntry","hasBabelLoader","includeRegex","modulePath","queryParamStartIndex","indexOf","slice","re","options","include"],"sources":["../../src/utils/webpack.config.js"],"sourcesContent":["const crypto = require(`crypto`)\nconst fs = require(`fs-extra`)\nconst path = require(`path`)\nconst dotenv = require(`dotenv`)\nconst { CoreJSResolver } = require(`./webpack/plugins/corejs-resolver`)\nconst {\n  CacheFolderResolver,\n} = require(`./webpack/plugins/cache-folder-resolver`)\nconst { store } = require(`../redux`)\nconst { actions } = require(`../redux/actions`)\nconst { getPublicPath } = require(`./get-public-path`)\nconst debug = require(`debug`)(`gatsby:webpack-config`)\nconst reporter = require(`gatsby-cli/lib/reporter`)\nimport { withBasePath, withTrailingSlash } from \"./path\"\nimport { getGatsbyDependents } from \"./gatsby-dependents\"\nconst apiRunnerNode = require(`./api-runner-node`)\nimport { createWebpackUtils } from \"./webpack-utils\"\nimport { hasLocalEslint } from \"./local-eslint-config-finder\"\nimport { getAbsolutePathForVirtualModule } from \"./gatsby-webpack-virtual-modules\"\nimport { StaticQueryMapper } from \"./webpack/plugins/static-query-mapper\"\nimport { ForceCssHMRForEdgeCases } from \"./webpack/plugins/force-css-hmr-for-edge-cases\"\nimport { WebpackLoggingPlugin } from \"./webpack/plugins/webpack-logging\"\nimport { hasES6ModuleSupport } from \"./browserslist\"\nimport { builtinModules } from \"module\"\nimport { shouldGenerateEngines } from \"./engines-helpers\"\nimport { ROUTES_DIRECTORY } from \"../constants\"\nimport { BabelConfigItemsCacheInvalidatorPlugin } from \"./babel-loader\"\nimport { PartialHydrationPlugin } from \"./webpack/plugins/partial-hydration\"\nimport { satisfiesSemvers } from \"./flags\"\n\nconst FRAMEWORK_BUNDLES = [`react`, `react-dom`, `scheduler`, `prop-types`]\n\n// Four stages or modes:\n//   1) develop: for `gatsby develop` command, hot reload and CSS injection into page\n//   2) develop-html: same as develop without react-hmre in the babel config for html renderer\n//   3) build-javascript: Build JS and CSS chunks for production\n//   4) build-html: build all HTML files\n\nmodule.exports = async (\n  program,\n  directory,\n  suppliedStage,\n  port,\n  { parentSpan } = {}\n) => {\n  let fastRefreshPlugin\n  const modulesThatUseGatsby = await getGatsbyDependents()\n  const directoryPath = withBasePath(directory)\n\n  // We combine develop & develop-html stages for purposes of generating the\n  // webpack config.\n  const stage = suppliedStage\n  const { rules, loaders, plugins } = createWebpackUtils(stage, program)\n\n  const { assetPrefix, pathPrefix, trailingSlash } = store.getState().config\n\n  const publicPath = getPublicPath({ assetPrefix, pathPrefix, ...program })\n  const isPartialHydrationEnabled =\n    (process.env.GATSBY_PARTIAL_HYDRATION === `true` ||\n      process.env.GATSBY_PARTIAL_HYDRATION === `1`) &&\n    _CFLAGS_.GATSBY_MAJOR === `5`\n\n  function processEnv(stage, defaultNodeEnv) {\n    debug(`Building env for \"${stage}\"`)\n    // node env should be DEVELOPMENT | PRODUCTION as these are commonly used in node land\n    // this variable is used inside webpack\n    const nodeEnv = process.env.NODE_ENV || `${defaultNodeEnv}`\n    // config env is dependent on the env that it's run, this can be anything from staging-production\n    // this allows you to set use different .env environments or conditions in gatsby files\n    const configEnv = process.env.GATSBY_ACTIVE_ENV || nodeEnv\n    const envFile = path.join(process.cwd(), `./.env.${configEnv}`)\n    let parsed = {}\n    try {\n      parsed = dotenv.parse(fs.readFileSync(envFile, { encoding: `utf8` }))\n    } catch (err) {\n      if (err.code !== `ENOENT`) {\n        reporter.error(\n          `There was a problem processing the .env file (${envFile})`,\n          err\n        )\n      }\n    }\n\n    const target =\n      stage === `build-html` || stage === `develop-html` ? `node` : `web`\n\n    const envObject = Object.keys(parsed).reduce((acc, key) => {\n      acc[key] = JSON.stringify(parsed[key])\n      return acc\n    }, {})\n\n    const gatsbyVarObject = Object.keys(process.env).reduce((acc, key) => {\n      if (target === `node` || key.match(/^GATSBY_/)) {\n        acc[key] = JSON.stringify(process.env[key])\n      }\n      return acc\n    }, {})\n\n    // Don't allow overwriting of NODE_ENV, PUBLIC_DIR as to not break gatsby things\n    envObject.NODE_ENV = JSON.stringify(nodeEnv)\n    envObject.PUBLIC_DIR = JSON.stringify(`${process.cwd()}/public`)\n    envObject.BUILD_STAGE = JSON.stringify(stage)\n    envObject.CYPRESS_SUPPORT = JSON.stringify(process.env.CYPRESS_SUPPORT)\n    envObject.GATSBY_QUERY_ON_DEMAND = JSON.stringify(\n      !!process.env.GATSBY_QUERY_ON_DEMAND\n    )\n\n    if (stage === `develop`) {\n      envObject.GATSBY_SOCKET_IO_DEFAULT_TRANSPORT = JSON.stringify(\n        process.env.GATSBY_SOCKET_IO_DEFAULT_TRANSPORT || `websocket`\n      )\n    }\n\n    const mergedEnvVars = Object.assign(envObject, gatsbyVarObject)\n\n    return Object.keys(mergedEnvVars).reduce(\n      (acc, key) => {\n        acc[`process.env.${key}`] = mergedEnvVars[key]\n        return acc\n      },\n      {\n        \"process.env\": `({})`,\n      }\n    )\n  }\n\n  debug(`Loading webpack config for stage \"${stage}\"`)\n  function getOutput() {\n    switch (stage) {\n      case `develop`:\n        return {\n          path: directory,\n          filename: `[name].js`,\n          // Add /* filename */ comments to generated require()s in the output.\n          pathinfo: true,\n          // Point sourcemap entries to original disk location (format as URL on Windows)\n          publicPath: process.env.GATSBY_WEBPACK_PUBLICPATH || `/`,\n          devtoolModuleFilenameTemplate: info =>\n            path.resolve(info.absoluteResourcePath).replace(/\\\\/g, `/`),\n          // Avoid React cross-origin errors\n          // See https://reactjs.org/docs/cross-origin-errors.html\n          crossOriginLoading: `anonymous`,\n        }\n      case `build-html`:\n      case `develop-html`:\n        // Generate the file needed to SSR pages.\n        // Deleted by build-html.js, since it's not needed for production.\n        return {\n          path: directoryPath(ROUTES_DIRECTORY),\n          filename: `[name].js`,\n          chunkFilename: `[name].js`,\n          library: {\n            type: `commonjs`,\n          },\n          publicPath: withTrailingSlash(publicPath),\n        }\n      case `build-javascript`:\n        return {\n          filename: `[name]-[contenthash].js`,\n          chunkFilename: `[name]-[contenthash].js`,\n          path: directoryPath(`public`),\n          publicPath: withTrailingSlash(publicPath),\n        }\n      default:\n        throw new Error(`The state requested ${stage} doesn't exist.`)\n    }\n  }\n\n  function getEntry() {\n    switch (stage) {\n      case `develop`:\n        return hasES6ModuleSupport(directory)\n          ? {\n              commons: [directoryPath(`.cache/app`)],\n            }\n          : {\n              polyfill: directoryPath(`.cache/polyfill-entry`),\n              commons: [directoryPath(`.cache/app`)],\n            }\n      case `develop-html`:\n        return {\n          \"render-page\": process.env.GATSBY_EXPERIMENTAL_DEV_SSR\n            ? directoryPath(`.cache/ssr-develop-static-entry`)\n            : directoryPath(`.cache/develop-static-entry`),\n        }\n      case `build-html`: {\n        return {\n          \"render-page\": directoryPath(`.cache/static-entry`),\n        }\n      }\n      case `build-javascript`:\n        return hasES6ModuleSupport(directory)\n          ? {\n              app: directoryPath(`.cache/production-app`),\n            }\n          : {\n              polyfill: directoryPath(`.cache/polyfill-entry`),\n              app: directoryPath(`.cache/production-app`),\n            }\n      default:\n        throw new Error(`The state requested ${stage} doesn't exist.`)\n    }\n  }\n\n  function getPlugins() {\n    let configPlugins = [\n      plugins.moment(),\n\n      // Add a few global variables. Set NODE_ENV to production (enables\n      // optimizations for React) and what the link prefix is (__PATH_PREFIX__).\n      plugins.define({\n        ...processEnv(stage, `development`),\n        __BASE_PATH__: JSON.stringify(program.prefixPaths ? pathPrefix : ``),\n        __PATH_PREFIX__: JSON.stringify(program.prefixPaths ? publicPath : ``),\n        __ASSET_PREFIX__: JSON.stringify(\n          program.prefixPaths ? assetPrefix : ``\n        ),\n        __TRAILING_SLASH__: JSON.stringify(trailingSlash),\n        // TODO Improve asset passing to pages\n        BROWSER_ESM_ONLY: JSON.stringify(hasES6ModuleSupport(directory)),\n        \"global.hasPartialHydration\": isPartialHydrationEnabled,\n      }),\n\n      plugins.virtualModules(),\n      new BabelConfigItemsCacheInvalidatorPlugin(),\n      process.env.GATSBY_WEBPACK_LOGGING?.split(`,`)?.includes(stage) &&\n        new WebpackLoggingPlugin(program.directory, reporter, program.verbose),\n    ].filter(Boolean)\n\n    switch (stage) {\n      case `develop`: {\n        configPlugins = configPlugins\n          .concat([\n            (fastRefreshPlugin = plugins.fastRefresh({ modulesThatUseGatsby })),\n            new ForceCssHMRForEdgeCases(),\n            plugins.hotModuleReplacement(),\n            plugins.noEmitOnErrors(),\n            new StaticQueryMapper(store),\n          ])\n          .filter(Boolean)\n\n        configPlugins.push(\n          plugins.extractText({\n            filename: `[name].css`,\n            chunkFilename: `[id].css`,\n          })\n        )\n\n        if (process.env.GATSBY_EXPERIMENTAL_DEV_SSR) {\n          configPlugins.push(plugins.extractStats())\n        }\n\n        const isCustomEslint = hasLocalEslint(program.directory)\n\n        // if no local eslint config, then add gatsby config\n        if (!isCustomEslint) {\n          configPlugins.push(plugins.eslint())\n        }\n\n        // Enforce fast-refresh rules even with local eslint config\n        if (isCustomEslint) {\n          configPlugins.push(plugins.eslintRequired())\n        }\n\n        break\n      }\n      case `build-javascript`: {\n        configPlugins = configPlugins\n          .concat([\n            plugins.extractText({\n              filename: `[name].[contenthash].css`,\n              chunkFilename: `[name].[contenthash].css`,\n            }),\n            // Write out stats object mapping named dynamic imports (aka page\n            // components) to all their async chunks.\n            plugins.extractStats(),\n            new StaticQueryMapper(store),\n            isPartialHydrationEnabled\n              ? new PartialHydrationPlugin(\n                  path.join(\n                    directory,\n                    `.cache`,\n                    `partial-hydration`,\n                    `manifest.json`\n                  ),\n                  reporter\n                )\n              : null,\n          ])\n          .filter(Boolean)\n        break\n      }\n      case `develop-html`:\n      case `build-html`: {\n        // Add global fetch in node environments\n        configPlugins.push(\n          plugins.provide({\n            fetch: require.resolve(`node-fetch`),\n            \"global.fetch\": require.resolve(`node-fetch`),\n          })\n        )\n        break\n      }\n    }\n\n    return configPlugins\n  }\n\n  function getDevtool() {\n    switch (stage) {\n      case `develop`:\n        return `eval-cheap-module-source-map`\n      // use a normal `source-map` for the html phases since\n      // it gives better line and column numbers\n      case `develop-html`:\n      case `build-html`:\n      case `build-javascript`:\n        return `source-map`\n      default:\n        return false\n    }\n  }\n\n  function getMode() {\n    switch (stage) {\n      case `develop`:\n      case `develop-html`:\n        return `development`\n      case `build-javascript`:\n      case `build-html`:\n      default:\n        return `production`\n    }\n  }\n\n  function getModule() {\n    // Common config for every env.\n    // prettier-ignore\n    let configRules = [\n      // Webpack expects extensions when importing ESM modules as that's what the spec describes.\n      // Not all libraries have adapted so we don't enforce its behaviour\n      // @see https://github.com/webpack/webpack/issues/11467\n      {\n        test: /\\.mjs$/i,\n        resolve: {\n          byDependency: {\n            esm: {\n              fullySpecified: false,\n            },\n          },\n        },\n      },\n      {\n        test: /\\.js$/i,\n        descriptionData: {\n          type: `module`,\n        },\n        resolve: {\n          byDependency: {\n            esm: {\n              fullySpecified: false,\n            },\n          },\n        },\n      },\n      rules.js({\n        modulesThatUseGatsby,\n      }),\n      rules.yaml(),\n      rules.fonts(),\n      rules.images(),\n      rules.media(),\n      rules.miscAssets(),\n    ]\n\n    // TODO(v5): Remove since this is only useful during Gatsby 4 publishes\n    if (_CFLAGS_.GATSBY_MAJOR !== `5`) {\n      configRules.push({\n        test: require.resolve(`@gatsbyjs/reach-router/es/index`),\n        type: `javascript/auto`,\n        use: [\n          {\n            loader: require.resolve(\n              `./reach-router-add-basecontext-export-loader`\n            ),\n          },\n        ],\n      })\n    }\n\n    // Speedup 🏎️💨 the build! We only include transpilation of node_modules on javascript production builds\n    // TODO create gatsby plugin to enable this behaviour on develop (only when people are requesting this feature)\n    if (stage === `build-javascript` && !hasES6ModuleSupport(directory)) {\n      configRules.push(\n        rules.dependencies({\n          modulesThatUseGatsby,\n        })\n      )\n    }\n\n    switch (stage) {\n      case `develop`: {\n        configRules = configRules.concat([\n          {\n            oneOf: [rules.cssModules(), rules.css()],\n          },\n        ])\n\n        break\n      }\n      case `build-html`:\n      case `develop-html`:\n        // We don't deal with CSS at all when building the HTML.\n        // The 'null' loader is used to prevent 'module not found' errors.\n        // On the other hand CSS modules loaders are necessary.\n\n        // prettier-ignore\n        configRules = configRules.concat([\n          {\n            oneOf: [\n              rules.cssModules(),\n              {\n                ...rules.css(),\n                use: [loaders.null()],\n              },\n            ],\n          },\n        ])\n        break\n\n      case `build-javascript`:\n        // We don't deal with CSS at all when building JavaScript but we still\n        // need to process the CSS so offline-plugin knows about the various\n        // assets referenced in your CSS.\n        //\n        // It's also necessary to process CSS Modules so your JS knows the\n        // classNames to use.\n        configRules = configRules.concat([\n          {\n            oneOf: [rules.cssModules(), rules.css()],\n          },\n        ])\n\n        break\n    }\n\n    // TODO(v5): Remove since this is only useful during Gatsby 4 publishes\n    // Removes it from the client payload as it's not used there\n    if (_CFLAGS_.GATSBY_MAJOR !== `5`) {\n      configRules.push({\n        test: /react-server-dom-webpack/,\n        use: loaders.null(),\n      })\n    }\n\n    return { rules: configRules }\n  }\n\n  function getPackageRoot(pkg) {\n    return path.dirname(require.resolve(`${pkg}/package.json`))\n  }\n\n  function getResolve(stage) {\n    const { program } = store.getState()\n    const resolve = {\n      // Use the program's extension list (generated via the\n      // 'resolvableExtensions' API hook).\n      extensions: [...program.extensions],\n      alias: {\n        gatsby$: directoryPath(path.join(`.cache`, `gatsby-browser-entry.js`)),\n        // Using directories for module resolution is mandatory because\n        // relative path imports are used sometimes\n        // See https://stackoverflow.com/a/49455609/6420957 for more details\n        \"@babel/runtime\": getPackageRoot(`@babel/runtime`),\n        \"@reach/router\": getPackageRoot(`@gatsbyjs/reach-router`),\n        \"react-lifecycles-compat\": directoryPath(\n          `.cache/react-lifecycles-compat.js`\n        ),\n        \"react-server-dom-webpack\": getPackageRoot(`react-server-dom-webpack`),\n        \"@pmmmwh/react-refresh-webpack-plugin\": getPackageRoot(\n          `@pmmmwh/react-refresh-webpack-plugin`\n        ),\n        \"socket.io-client\": getPackageRoot(`socket.io-client`),\n        \"webpack-hot-middleware\": getPackageRoot(\n          `@gatsbyjs/webpack-hot-middleware`\n        ),\n        $virtual: getAbsolutePathForVirtualModule(`$virtual`),\n      },\n      plugins: [\n        new CoreJSResolver(),\n        new CacheFolderResolver(path.join(program.directory, `.cache`)),\n      ],\n    }\n\n    const target =\n      stage === `build-html` || stage === `develop-html` ? `node` : `web`\n    if (target === `web`) {\n      // TODO(v5): Remove since this is only useful during Gatsby 4 publishes\n      if (_CFLAGS_.GATSBY_MAJOR !== `5`) {\n        resolve.alias[`@reach/router`] = path.join(\n          getPackageRoot(`@gatsbyjs/reach-router`),\n          `es`\n        )\n      }\n\n      resolve.alias[`gatsby-core-utils/create-content-digest`] = directoryPath(\n        `.cache/create-content-digest-browser-shim`\n      )\n    }\n\n    if (stage === `build-javascript` && program.profile) {\n      resolve.alias[`react-dom$`] = `react-dom/profiling`\n      resolve.alias[`scheduler/tracing`] = `scheduler/tracing-profiling`\n    }\n\n    // SSR can have many react versions as some packages use their own version. React works best with 1 version.\n    // By resolving react,react-dom from gatsby we'll get the site versions of react & react-dom because it's specified as a peerdependency.\n    //\n    // we need to put this below our resolve.alias for profiling as webpack picks the first one that matches\n    // @see https://github.com/gatsbyjs/gatsby/issues/31098\n    resolve.alias[`react`] = getPackageRoot(`react`)\n    resolve.alias[`react-dom`] = getPackageRoot(`react-dom`)\n\n    return resolve\n  }\n\n  function getResolveLoader() {\n    const root = [path.resolve(directory, `node_modules`)]\n\n    const userLoaderDirectoryPath = path.resolve(directory, `loaders`)\n\n    try {\n      if (fs.statSync(userLoaderDirectoryPath).isDirectory()) {\n        root.push(userLoaderDirectoryPath)\n      }\n    } catch (err) {\n      debug(`Error resolving user loaders directory`, err)\n    }\n\n    return {\n      modules: [...root, path.join(__dirname, `../loaders`), `node_modules`],\n    }\n  }\n\n  const config = {\n    name: stage,\n    // Context is the base directory for resolving the entry option.\n    context: directory,\n    entry: getEntry(),\n    output: getOutput(),\n\n    module: getModule(),\n    plugins: getPlugins(),\n\n    devtool: getDevtool(),\n    // Turn off performance hints as we (for now) don't want to show the normal\n    // webpack output anywhere.\n    performance: {\n      hints: false,\n    },\n    mode: getMode(),\n\n    resolveLoader: getResolveLoader(),\n    resolve: getResolve(stage),\n  }\n\n  if (stage === `build-html` || stage === `develop-html`) {\n    config.target = `node14.15`\n  } else {\n    config.target = [`web`, `es5`]\n  }\n\n  const isCssModule = module => module.type === `css/mini-extract`\n\n  if (stage === `develop`) {\n    config.optimization = {\n      splitChunks: {\n        chunks: `all`,\n        cacheGroups: {\n          default: false,\n          defaultVendors: false,\n          framework: {\n            chunks: `all`,\n            name: `framework`,\n            // This regex ignores nested copies of framework libraries so they're bundled with their issuer.\n            test: new RegExp(\n              `(?<!node_modules.*)[\\\\\\\\/]node_modules[\\\\\\\\/](${FRAMEWORK_BUNDLES.join(\n                `|`\n              )})[\\\\\\\\/]`\n            ),\n            priority: 40,\n            // Don't let webpack eliminate this chunk (prevents this chunk from becoming a part of the commons chunk)\n            enforce: true,\n          },\n          // Bundle all css & lazy css into one stylesheet to make sure lazy components do not break\n          // TODO make an exception for css-modules\n          styles: {\n            test(module) {\n              return isCssModule(module)\n            },\n\n            name: `commons`,\n            priority: 40,\n            enforce: true,\n          },\n        },\n      },\n      minimize: false,\n    }\n  }\n\n  if (stage === `build-html` || stage === `develop-html`) {\n    config.optimization = {\n      // TODO fix our partial hydration manifest\n      mangleExports: !isPartialHydrationEnabled,\n      splitChunks: {\n        cacheGroups: {\n          default: false,\n          defaultVendors: false,\n        },\n      },\n      minimize: false,\n    }\n  }\n\n  if (stage === `build-javascript`) {\n    const componentsCount = store.getState().components.size\n\n    const splitChunks = {\n      chunks: `all`,\n      cacheGroups: {\n        default: false,\n        defaultVendors: false,\n        framework: {\n          chunks: `all`,\n          name: `framework`,\n          // This regex ignores nested copies of framework libraries so they're bundled with their issuer.\n          test: new RegExp(\n            `(?<!node_modules.*)[\\\\\\\\/]node_modules[\\\\\\\\/](${FRAMEWORK_BUNDLES.join(\n              `|`\n            )})[\\\\\\\\/]`\n          ),\n          priority: 40,\n          // Don't let webpack eliminate this chunk (prevents this chunk from becoming a part of the commons chunk)\n          enforce: true,\n        },\n        // if a module is bigger than 160kb from node_modules we make a separate chunk for it\n        lib: {\n          test(module) {\n            return (\n              !isCssModule(module) &&\n              module.size() > 160000 &&\n              /node_modules[/\\\\]/.test(module.identifier())\n            )\n          },\n          name(module) {\n            const hash = crypto.createHash(`sha1`)\n            if (!module.libIdent) {\n              throw new Error(\n                `Encountered unknown module type: ${module.type}. Please open an issue.`\n              )\n            }\n\n            hash.update(module.libIdent({ context: program.directory }))\n\n            return hash.digest(`hex`).substring(0, 8)\n          },\n          priority: 30,\n          minChunks: 1,\n          reuseExistingChunk: true,\n        },\n        commons: {\n          name: `commons`,\n          // if a chunk is used on all components we put it in commons (we need at least 2 components)\n          minChunks: Math.max(componentsCount, 2),\n          priority: 20,\n        },\n        // If a chunk is used in at least 2 components we create a separate chunk\n        shared: {\n          test(module, { chunkGraph }) {\n            for (const chunk of chunkGraph.getModuleChunksIterable(module)) {\n              if (chunk.canBeInitial()) {\n                return false\n              }\n            }\n\n            return !isCssModule(module)\n          },\n          name(module, chunks) {\n            const hash = crypto\n              .createHash(`sha1`)\n              .update(chunks.reduce((acc, chunk) => acc + chunk.name, ``))\n              .digest(`hex`)\n\n            return hash\n          },\n          priority: 10,\n          minChunks: 2,\n          reuseExistingChunk: true,\n        },\n\n        // Bundle all css & lazy css into one stylesheet to make sure lazy components do not break\n        // TODO make an exception for css-modules\n        styles: {\n          test(module) {\n            return isCssModule(module)\n          },\n\n          name: `styles`,\n          priority: 40,\n          enforce: true,\n        },\n      },\n      // We load our pages async through async-requires, maxInitialRequests doesn't have an effect on chunks derived from page components.\n      // By default webpack has set maxAsyncRequests to 6, in some cases this isn't enough an actually makes the bundle size blow up.\n      // We've set maxAsyncRequests to Infinity to negate this. This could potentionally exceed the 25 initial requests that we set before\n      // sadly I do not have a better solution.\n      maxAsyncRequests: Infinity,\n      maxInitialRequests: 25,\n      minSize: 20000,\n    }\n\n    config.optimization = {\n      runtimeChunk: {\n        name: `webpack-runtime`,\n      },\n      // TODO fix our partial hydration manifest\n      mangleExports: !isPartialHydrationEnabled,\n      splitChunks,\n      minimizer: [\n        // TODO: maybe this option should be noMinimize?\n        !program.noUglify &&\n          plugins.minifyJs(\n            program.profile\n              ? {\n                  terserOptions: {\n                    keep_classnames: true,\n                    keep_fnames: true,\n                  },\n                }\n              : {}\n          ),\n        plugins.minifyCss(),\n      ].filter(Boolean),\n    }\n  }\n\n  if (stage === `build-html` || stage === `develop-html`) {\n    // externalize react, react-dom when develop-html or build-html(when not generating engines)\n    const shouldMarkPackagesAsExternal =\n      stage === `develop-html` || !shouldGenerateEngines()\n\n    // tracking = build-html (when not generating engines)\n    const shouldTrackBuiltins =\n      stage === `build-html` && !shouldGenerateEngines()\n\n    // removes node internals from bundle\n    // https://webpack.js.org/configuration/externals/#externalspresets\n    config.externalsPresets = {\n      // use it only when not tracking builtins (tracking builtins provide their own fallbacks)\n      node: !shouldTrackBuiltins,\n    }\n    config.externals = []\n\n    if (shouldMarkPackagesAsExternal) {\n      // Packages we want to externalize to save some build time\n      // https://github.com/gatsbyjs/gatsby/pull/14208#pullrequestreview-240178728\n      // const externalList = [`common-tags`, `lodash`, `semver`, /^lodash\\//]\n\n      // Packages we want to externalize because meant to be user-provided\n      const userExternalList = [`react`, /^react-dom\\//]\n\n      const checkItem = (item, request) => {\n        if (typeof item === `string` && item === request) {\n          return true\n        } else if (item instanceof RegExp && item.test(request)) {\n          return true\n        }\n\n        return false\n      }\n\n      config.externals.push(function (\n        { context, getResolve, request },\n        callback\n      ) {\n        // allows us to resolve webpack aliases from our config\n        // helpful for when react is aliased to preact-compat\n        // Force commonjs as we're in node land\n        const resolver = getResolve({\n          dependencyType: `commonjs`,\n        })\n\n        // User modules that do not need to be part of the bundle\n        if (userExternalList.some(item => checkItem(item, request))) {\n          // TODO figure out to make preact work with this too\n\n          resolver(context, request, (err, newRequest) => {\n            if (err) {\n              callback(err)\n              return\n            }\n\n            callback(null, newRequest)\n          })\n          return\n        }\n        // TODO look into re-enabling, breaks builds right now because of esm\n        // User modules that do not need to be part of the bundle\n        // if (externalList.some(item => checkItem(item, request))) {\n        //   resolver(context, request, (err, request) => {\n        //     if (err) {\n        //       callback(err)\n        //       return\n        //     }\n\n        //     callback(null, `commonjs2 ${request}`)\n        //   })\n        //   return\n        // }\n\n        callback()\n      })\n    }\n\n    if (shouldTrackBuiltins) {\n      if (stage === `build-html`) {\n        const builtinModulesToTrack = [\n          `fs`,\n          `http`,\n          `http2`,\n          `https`,\n          `child_process`,\n        ]\n        const builtinsExternalsDictionary = builtinModules.reduce(\n          (acc, builtinModule) => {\n            if (builtinModulesToTrack.includes(builtinModule)) {\n              acc[builtinModule] = `commonjs ${path.join(\n                program.directory,\n                `.cache`,\n                `ssr-builtin-trackers`,\n                builtinModule\n              )}`\n            } else {\n              acc[builtinModule] = `commonjs ${builtinModule}`\n            }\n            return acc\n          },\n          {}\n        )\n\n        config.externals.unshift(builtinsExternalsDictionary)\n      }\n    }\n  }\n\n  if (stage === `develop`) {\n    config.externals = {\n      \"socket.io-client\": `io`,\n    }\n  }\n\n  if (\n    stage === `build-javascript` ||\n    stage === `build-html` ||\n    stage === `develop` ||\n    stage === `develop-html`\n  ) {\n    const cacheLocation = path.join(\n      program.directory,\n      `.cache`,\n      `webpack`,\n      `stage-` + stage\n    )\n\n    const cacheConfig = {\n      type: `filesystem`,\n      name: stage,\n      cacheLocation,\n      buildDependencies: {\n        config: [\n          __filename,\n          ...store\n            .getState()\n            .flattenedPlugins.filter(plugin =>\n              plugin.nodeAPIs.includes(`onCreateWebpackConfig`)\n            )\n            .map(\n              plugin =>\n                plugin.resolvedCompiledGatsbyNode ??\n                path.join(plugin.resolve, `gatsby-node.js`)\n            ),\n        ],\n      },\n    }\n\n    config.cache = cacheConfig\n  }\n\n  store.dispatch(actions.replaceWebpackConfig(config))\n  const getConfig = () => store.getState().webpack\n\n  await apiRunnerNode(`onCreateWebpackConfig`, {\n    getConfig,\n    // we will converge to build-html later on but for now this was the fastest way to get SSR to work\n    stage,\n    rules,\n    loaders,\n    plugins,\n    parentSpan,\n  })\n\n  if (fastRefreshPlugin) {\n    // Fast refresh plugin has `include` option that determines\n    // wether HMR code gets injected. We need to make sure all custom loaders\n    // (like .ts or .mdx) that use our babel-loader will be taken into account\n    // when deciding which modules get fast-refresh HMR addition.\n    const fastRefreshIncludes = []\n    const babelLoaderLoc = require.resolve(`./babel-loader`)\n    for (const rule of getConfig().module.rules) {\n      if (!rule.use && !rule.loader) {\n        continue\n      }\n\n      let use = rule.use\n\n      if (typeof use === `function`) {\n        use = rule.use({})\n      }\n\n      const ruleLoaders = Array.isArray(use)\n        ? use.map(useEntry =>\n            typeof useEntry === `string` ? useEntry : useEntry.loader\n          )\n        : [use?.loader ?? rule.loader]\n\n      const hasBabelLoader = ruleLoaders.some(\n        loader => loader === babelLoaderLoc\n      )\n\n      if (hasBabelLoader) {\n        fastRefreshIncludes.push(rule.test)\n      }\n    }\n\n    // start with default include of fast refresh plugin\n    const includeRegex = /\\.([jt]sx?|flow)$/i\n    includeRegex.test = modulePath => {\n      // drop query param from request (i.e. ?type=component for mdx-loader)\n      // so loader rule test work well\n      const queryParamStartIndex = modulePath.indexOf(`?`)\n      if (queryParamStartIndex !== -1) {\n        modulePath = modulePath.slice(0, queryParamStartIndex)\n      }\n\n      return fastRefreshIncludes.some(re => re.test(modulePath))\n    }\n\n    fastRefreshPlugin.options.include = includeRegex\n  }\n\n  return getConfig()\n}\n"],"mappings":"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"}