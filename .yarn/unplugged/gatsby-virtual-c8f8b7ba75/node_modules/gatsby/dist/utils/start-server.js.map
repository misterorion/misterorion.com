{"version":3,"file":"start-server.js","names":["startServer","program","app","workerPool","WorkerPool","create","directory","PAGE_RENDERER_PATH","path","join","ROUTES_DIRECTORY","webpackActivity","report","activityTimer","id","start","writeVirtualLoadingIndicatorModule","directoryPath","withBasePath","buildRenderer","doBuildPages","require","createIndexHtml","activity","rendererPath","close","Stage","DevelopHTML","span","err","name","panic","stripIndent","indexHTMLActivity","phantomActivity","pageRenderer","process","env","GATSBY_EXPERIMENTAL_DEV_SSR","initDevWorkerPool","end","devConfig","webpackConfig","Develop","port","parentSpan","compiler","webpack","use","compression","telemetry","expressMiddleware","webpackHotMiddleware","log","heartbeat","cors","graphqlEndpoint","graphiqlExplorer","getFragments","fragments","def","store","getState","definitions","values","kind","Kind","FRAGMENT_DEFINITION","push","createGraphqlEndpointHandler","schema","context","withResolverContext","schemaComposer","schemaCustomization","composer","customContext","onOperation","_req","_args","result","errors","map","toJSON","extensions","stack","split","enableRefresh","ENABLE_GATSBY_REFRESH_ENDPOINT","refreshToken","GATSBY_REFRESH_TOKEN","REFRESH_ENDPOINT","refresh","req","pluginName","global","__GATSBY","buildId","uuid","v4","emitter","emit","webhookBody","body","post","express","json","res","params","authorizedRefresh","headers","authorization","status","setHeader","error","isEnabled","get","query","fileName","resolve","cwd","lineNumber","parseInt","launchEditor","isNaN","addImageRoutes","webpackDevMiddlewareInstance","webpackDevMiddleware","publicPath","output","stats","serverSideRender","next","requestedPagePath","pagePath","potentialPagePath","reverseFixedPagePath","page","findPageByPath","serverDataPromise","Promise","pageMode","getPageMode","renderer","componentInstance","getPageChunk","getServerData","catch","pageData","GATSBY_QUERY_ON_DEMAND","Date","now","getPageDataExperimental","trackCli","duration","readPageData","statusCode","Error","value","Object","entries","serverData","props","getServerDataError","structuredError","panicOnBuild","sourceMessage","message","matchPath","send","e","emptyResponse","codeFrame","sourcePosition","sourceContent","sourceLine","sourceColumn","sourceEndLine","sourceEndColumn","skipSourceMap","moduleId","absolutePath","fs","readFileSync","endLineNumber","columnNumber","endColumnNumber","line","column","compilation","locals","devMiddleware","fileModule","module","modules","moduleIdentifier","chunkGraph","getModuleId","webpackSource","codeGenerationResults","sources","sourceMap","position","findOriginalSourcePositionAndContent","codeFrameColumns","undefined","highlightCode","filePath","readFile","developMiddleware","config","proxy","trailingSlash","configureTrailingSlash","developStatic","index","forEach","prefix","url","proxiedUrl","originalUrl","host","method","pipe","got","stream","decompress","on","response","writeHead","_","sendStatus","apiRunnerNode","deferNodeMutation","trackFeatureIsUsed","pathObj","decodeURI","allowTimedFallback","appendPreloadHeaders","htmlActivity","html","renderResponse","renderDevHTML","skipSsr","prototype","hasOwnProperty","call","htmlComponentRendererPath","filename","source","clientOnlyShell","location","minimalHTML","GATSBY_QUERY_ON_DEMAND_LOADING_INDICATOR","routeLoadingIndicatorRequests","fullUrl","protocol","endsWith","webpackCompilationHash","sendFile","server","ssl","https","Server","http","socket","websocketManager","init","listener","listen","chokidar","watchGlobs","slash","watch","to","webpackWatching","watching"],"sources":["../../src/utils/start-server.ts"],"sourcesContent":["import webpackHotMiddleware from \"@gatsbyjs/webpack-hot-middleware\"\nimport webpackDevMiddleware from \"webpack-dev-middleware\"\nimport got, { Method } from \"got\"\nimport webpack from \"webpack\"\nimport express from \"express\"\nimport compression from \"compression\"\nimport { createHandler as createGraphqlEndpointHandler } from \"graphql-http/lib/use/express\"\nimport type { OperationContext } from \"graphql-http\"\nimport graphiqlExplorer from \"gatsby-graphiql-explorer\"\nimport { FragmentDefinitionNode, GraphQLError, Kind } from \"graphql\"\nimport { slash, uuid } from \"gatsby-core-utils\"\nimport http from \"http\"\nimport https from \"https\"\nimport cors from \"cors\"\nimport telemetry from \"gatsby-telemetry\"\nimport launchEditor from \"react-dev-utils/launchEditor\"\nimport { codeFrameColumns } from \"@babel/code-frame\"\nimport * as fs from \"fs-extra\"\n\nimport { withBasePath } from \"../utils/path\"\nimport webpackConfig from \"../utils/webpack.config\"\nimport { store, emitter } from \"../redux\"\nimport report from \"gatsby-cli/lib/reporter\"\nimport * as WorkerPool from \"../utils/worker/pool\"\n\nimport { developStatic } from \"../commands/develop-static\"\nimport withResolverContext from \"../schema/context\"\nimport { websocketManager, WebsocketManager } from \"../utils/websocket-manager\"\nimport {\n  reverseFixedPagePath,\n  readPageData,\n  IPageDataWithQueryResult,\n} from \"./page-data\"\nimport { getPageData as getPageDataExperimental } from \"./get-page-data\"\nimport { findPageByPath } from \"./find-page-by-path\"\nimport apiRunnerNode from \"../utils/api-runner-node\"\nimport * as path from \"path\"\n\nimport { Stage, IProgram } from \"../commands/types\"\nimport { findOriginalSourcePositionAndContent } from \"./stack-trace-utils\"\nimport { appendPreloadHeaders } from \"./develop-preload-headers\"\nimport {\n  routeLoadingIndicatorRequests,\n  writeVirtualLoadingIndicatorModule,\n} from \"./loading-indicator\"\nimport { renderDevHTML } from \"./dev-ssr/render-dev-html\"\nimport { getServerData, IServerData } from \"./get-server-data\"\nimport { ROUTES_DIRECTORY } from \"../constants\"\nimport { getPageMode } from \"./page-mode\"\nimport { configureTrailingSlash } from \"./express-middlewares\"\nimport type { Express } from \"express\"\nimport { addImageRoutes } from \"gatsby-plugin-utils/polyfill-remote-file\"\n\ntype ActivityTracker = any // TODO: Replace this with proper type once reporter is typed\n\ninterface IServer {\n  compiler: webpack.Compiler\n  listener: http.Server | https.Server\n  webpackActivity: ActivityTracker\n  websocketManager: WebsocketManager\n  workerPool: WorkerPool.GatsbyWorkerPool\n  webpackWatching: IWebpackWatchingPauseResume\n}\n\nexport interface IWebpackWatchingPauseResume {\n  suspend: () => void\n  resume: () => void\n}\n\nexport async function startServer(\n  program: IProgram,\n  app: Express,\n  workerPool: WorkerPool.GatsbyWorkerPool = WorkerPool.create()\n): Promise<IServer> {\n  const directory = program.directory\n  const PAGE_RENDERER_PATH = path.join(\n    program.directory,\n    ROUTES_DIRECTORY,\n    `render-page.js`\n  )\n\n  const webpackActivity = report.activityTimer(`Building development bundle`, {\n    id: `webpack-develop`,\n  })\n  webpackActivity.start()\n\n  // loading indicator\n  // write virtual module always to not fail webpack compilation, but only add express route handlers when\n  // query on demand is enabled and loading indicator is not disabled\n  writeVirtualLoadingIndicatorModule()\n\n  // Remove the following when merging GATSBY_EXPERIMENTAL_DEV_SSR\n  const directoryPath = withBasePath(directory)\n  const { buildRenderer, doBuildPages } = require(`../commands/build-html`)\n  const createIndexHtml = async (activity: ActivityTracker): Promise<void> => {\n    try {\n      const { rendererPath, close } = await buildRenderer(\n        program,\n        Stage.DevelopHTML,\n        activity.span\n      )\n      await doBuildPages(\n        rendererPath,\n        [`/`],\n        activity,\n        workerPool,\n        Stage.DevelopHTML\n      )\n      // close the compiler\n      await close()\n    } catch (err) {\n      if (err.name !== `WebpackError`) {\n        report.panic(err)\n        return\n      }\n      report.panic(\n        report.stripIndent`\n          There was an error compiling the html.js component for the development server.\n          See our docs page on debugging HTML builds for help https://gatsby.dev/debug-html\n        `,\n        err\n      )\n    }\n  }\n  const indexHTMLActivity = report.phantomActivity(`building index.html`, {})\n\n  let pageRenderer: string\n  if (process.env.GATSBY_EXPERIMENTAL_DEV_SSR) {\n    const { buildRenderer } = require(`../commands/build-html`)\n    pageRenderer = (await buildRenderer(program, Stage.DevelopHTML))\n      .rendererPath\n    const { initDevWorkerPool } = require(`./dev-ssr/render-dev-html`)\n    initDevWorkerPool()\n  } else {\n    indexHTMLActivity.start()\n\n    await createIndexHtml(indexHTMLActivity)\n\n    indexHTMLActivity.end()\n  }\n\n  const devConfig = await webpackConfig(\n    program,\n    directory,\n    Stage.Develop,\n    program.port,\n    {\n      parentSpan: webpackActivity.span,\n    }\n  )\n\n  const compiler = webpack(devConfig)\n\n  /**\n   * Set up the express app.\n   **/\n  app.use(compression())\n  app.use(telemetry.expressMiddleware(`DEVELOP`))\n  app.use(\n    webpackHotMiddleware(compiler, {\n      log: false,\n      path: `/__webpack_hmr`,\n      heartbeat: 10 * 1000,\n    })\n  )\n\n  app.use(cors())\n\n  /**\n   * Pattern matching all endpoints with graphql or graphiql with 1 or more leading underscores\n   */\n  const graphqlEndpoint = `/_+graphi?ql`\n\n  graphiqlExplorer(app, {\n    graphqlEndpoint,\n    getFragments: function getFragments(): Array<FragmentDefinitionNode> {\n      const fragments: Array<FragmentDefinitionNode> = []\n      for (const def of store.getState().definitions.values()) {\n        if (def.def.kind === Kind.FRAGMENT_DEFINITION) {\n          fragments.push(def.def)\n        }\n      }\n      return fragments\n    },\n  })\n\n  app.use(\n    graphqlEndpoint,\n    createGraphqlEndpointHandler({\n      schema() {\n        return store.getState().schema\n      },\n      context() {\n        return withResolverContext({\n          schema: store.getState().schema,\n          schemaComposer: store.getState().schemaCustomization.composer,\n          context: {},\n          customContext: store.getState().schemaCustomization.context,\n        }) as unknown as OperationContext\n      },\n      onOperation(_req, _args, result) {\n        if (result.errors) {\n          result.errors = result.errors.map(\n            err =>\n              ({\n                ...err.toJSON(),\n                extensions: {\n                  stack: err.stack ? err.stack.split(`\\n`) : [],\n                },\n              } as unknown as GraphQLError)\n          )\n        }\n\n        result.extensions = {\n          enableRefresh: process.env.ENABLE_GATSBY_REFRESH_ENDPOINT,\n          refreshToken: process.env.GATSBY_REFRESH_TOKEN,\n        }\n\n        return result\n      },\n    })\n  )\n\n  /**\n   * Refresh external data sources.\n   * This behavior is disabled by default, but the ENABLE_GATSBY_REFRESH_ENDPOINT env var enables it\n   * If no GATSBY_REFRESH_TOKEN env var is available, then no Authorization header is required\n   **/\n  const REFRESH_ENDPOINT = `/__refresh`\n  const refresh = async (\n    req: express.Request,\n    pluginName?: string\n  ): Promise<void> => {\n    global.__GATSBY.buildId = uuid.v4()\n\n    emitter.emit(`WEBHOOK_RECEIVED`, {\n      webhookBody: req.body,\n      pluginName,\n    })\n  }\n\n  app.post(`${REFRESH_ENDPOINT}/:plugin_name?`, express.json(), (req, res) => {\n    const pluginName = req.params[`plugin_name`]\n\n    const enableRefresh = process.env.ENABLE_GATSBY_REFRESH_ENDPOINT\n    const refreshToken = process.env.GATSBY_REFRESH_TOKEN\n    const authorizedRefresh =\n      !refreshToken || req.headers.authorization === refreshToken\n\n    if (enableRefresh && authorizedRefresh) {\n      refresh(req, pluginName)\n      res.status(200)\n      res.setHeader(`content-type`, `application/json`)\n    } else {\n      res.status(authorizedRefresh ? 404 : 403)\n      res.json({\n        error: enableRefresh\n          ? `Authorization failed. Make sure you add authorization header to your refresh requests`\n          : `Refresh endpoint is not enabled. Run gatsby with \"ENABLE_GATSBY_REFRESH_ENDPOINT=true\" environment variable set.`,\n        isEnabled: !!process.env.ENABLE_GATSBY_REFRESH_ENDPOINT,\n      })\n    }\n    res.end()\n  })\n\n  app.get(`/__open-stack-frame-in-editor`, (req, res) => {\n    if (req.query.fileName) {\n      const fileName = path.resolve(process.cwd(), req.query.fileName as string)\n      const lineNumber = parseInt(req.query.lineNumber as string, 10)\n      launchEditor(fileName, isNaN(lineNumber) ? 1 : lineNumber)\n    }\n    res.end()\n  })\n\n  addImageRoutes(app, store)\n\n  const webpackDevMiddlewareInstance = webpackDevMiddleware(compiler, {\n    publicPath: devConfig.output.publicPath,\n    stats: `errors-only`,\n    serverSideRender: true,\n  })\n\n  app.use(webpackDevMiddlewareInstance)\n\n  app.get(\n    `/page-data/:pagePath(*)/page-data.json`,\n    async (req, res, next): Promise<void> => {\n      const requestedPagePath = req.params.pagePath\n      if (!requestedPagePath) {\n        next()\n        return\n      }\n\n      const potentialPagePath = reverseFixedPagePath(requestedPagePath)\n      const page = findPageByPath(store.getState(), potentialPagePath, false)\n\n      if (page) {\n        try {\n          let serverDataPromise: Promise<IServerData> | Promise<Error> =\n            Promise.resolve({})\n          const pageMode = getPageMode(page)\n\n          if (pageMode === `SSR`) {\n            const renderer = require(PAGE_RENDERER_PATH)\n            const componentInstance = await renderer.getPageChunk(page)\n\n            serverDataPromise = getServerData(\n              req,\n              page,\n              potentialPagePath,\n              componentInstance\n            ).catch(error => error)\n          }\n\n          let pageData: IPageDataWithQueryResult\n          // TODO move to query-engine\n          if (process.env.GATSBY_QUERY_ON_DEMAND) {\n            const start = Date.now()\n\n            pageData = await getPageDataExperimental(page.path)\n\n            telemetry.trackCli(`RUN_QUERY_ON_DEMAND`, {\n              name: `getPageData`,\n              duration: Date.now() - start,\n            })\n          } else {\n            pageData = await readPageData(\n              path.join(store.getState().program.directory, `public`),\n              page.path\n            )\n          }\n\n          let statusCode = 200\n          if (pageMode === `SSR`) {\n            try {\n              const result = await serverDataPromise\n\n              if (result instanceof Error) {\n                throw result\n              }\n\n              if (result.headers) {\n                for (const [name, value] of Object.entries(result.headers)) {\n                  res.setHeader(name, value)\n                }\n              }\n\n              if (result.status) {\n                statusCode = result.status\n              }\n\n              pageData.result.serverData = result.props\n              pageData.getServerDataError = null\n            } catch (error) {\n              const structuredError = report.panicOnBuild({\n                id: `95315`,\n                context: {\n                  sourceMessage: error.message,\n                  pagePath: requestedPagePath,\n                  potentialPagePath,\n                },\n                error,\n              })\n              // Use page-data.json file instead of emitting via websockets as this makes it easier\n              // to only display the relevant error + clearing of the error\n              // The query-result-store reacts to this\n              pageData.getServerDataError = structuredError\n            }\n            pageData.path = page.matchPath ? `/${potentialPagePath}` : page.path\n          } else {\n            // When user removes getServerData function, Gatsby browser runtime still has cached version of page-data.\n            // Send `null` to always reset cached serverData:\n            pageData.result.serverData = null\n          }\n\n          res.status(statusCode).send(pageData)\n          return\n        } catch (e) {\n          report.error(\n            `Error loading a result for the page query in \"${requestedPagePath}\" / \"${potentialPagePath}\". Query was not run and no cached result was found.`,\n            e\n          )\n        }\n      }\n\n      res.status(404).send({\n        path: potentialPagePath,\n      })\n    }\n  )\n\n  app.get(`/__original-stack-frame`, (req, res) => {\n    const emptyResponse = {\n      codeFrame: `No codeFrame could be generated`,\n      sourcePosition: null,\n      sourceContent: null,\n    }\n\n    let sourceContent: string | null\n    let sourceLine: number | undefined\n    let sourceColumn: number | undefined\n    let sourceEndLine: number | undefined\n    let sourceEndColumn: number | undefined\n    let sourcePosition: { line?: number; column?: number } | null\n\n    if (req.query?.skipSourceMap) {\n      if (!req.query?.moduleId) {\n        res.json(emptyResponse)\n        return\n      }\n\n      const absolutePath = path.resolve(\n        store.getState().program.directory,\n        req.query.moduleId as string\n      )\n      try {\n        sourceContent = fs.readFileSync(absolutePath, `utf-8`)\n      } catch (e) {\n        res.json(emptyResponse)\n        return\n      }\n\n      if (req.query?.lineNumber) {\n        try {\n          sourceLine = parseInt(req.query.lineNumber as string, 10)\n\n          if (req.query?.endLineNumber) {\n            sourceEndLine = parseInt(req.query.endLineNumber as string, 10)\n          }\n          if (req.query?.columnNumber) {\n            sourceColumn = parseInt(req.query.columnNumber as string, 10)\n          }\n          if (req.query?.endColumnNumber) {\n            sourceEndColumn = parseInt(req.query.endColumnNumber as string, 10)\n          }\n        } catch {\n          // failed to get line/column, we should still try to show the code frame\n        }\n      }\n      sourcePosition = {\n        line: sourceLine,\n        column: sourceColumn,\n      }\n    } else {\n      const compilation = res.locals?.webpack?.devMiddleware?.stats?.compilation\n      if (!compilation) {\n        res.json(emptyResponse)\n        return\n      }\n\n      const moduleId = req.query?.moduleId\n      const lineNumber = parseInt((req.query?.lineNumber as string) ?? 1, 10)\n      const columnNumber = parseInt(\n        (req.query?.columnNumber as string) ?? 1,\n        10\n      )\n\n      let fileModule\n      for (const module of compilation.modules) {\n        const moduleIdentifier = compilation.chunkGraph.getModuleId(module)\n        if (moduleIdentifier === moduleId) {\n          fileModule = module\n          break\n        }\n      }\n\n      if (!fileModule) {\n        res.json(emptyResponse)\n        return\n      }\n\n      // We need the internal webpack file that is used in the bundle, not the module source.\n      // It doesn't have the correct sourceMap.\n      const webpackSource = compilation?.codeGenerationResults\n        ?.get(fileModule)\n        ?.sources.get(`javascript`)\n\n      const sourceMap = webpackSource?.map()\n\n      if (!sourceMap) {\n        res.json(emptyResponse)\n        return\n      }\n\n      const position = {\n        line: lineNumber,\n        column: columnNumber,\n      }\n      const result = findOriginalSourcePositionAndContent(sourceMap, position)\n\n      sourcePosition = result?.sourcePosition\n      sourceLine = sourcePosition?.line\n      sourceColumn = sourcePosition?.column\n      sourceContent = result?.sourceContent\n\n      if (!sourceContent || !sourceLine) {\n        res.json(emptyResponse)\n        return\n      }\n    }\n\n    const codeFrame = codeFrameColumns(\n      sourceContent,\n      {\n        start: {\n          line: sourceLine ?? 0,\n          column: sourceColumn ?? 0,\n        },\n        end: sourceEndLine\n          ? {\n              line: sourceEndLine,\n              column: sourceEndColumn,\n            }\n          : undefined,\n      },\n      {\n        highlightCode: true,\n      }\n    )\n    res.json({\n      codeFrame,\n      sourcePosition,\n      sourceContent,\n    })\n  })\n\n  app.get(`/__file-code-frame`, async (req, res) => {\n    const emptyResponse = {\n      codeFrame: `No codeFrame could be generated`,\n      sourcePosition: null,\n      sourceContent: null,\n    }\n\n    const filePath: string | undefined = req.query?.filePath as string\n    const lineNumber = parseInt(req.query?.lineNumber as string, 10)\n    const columnNumber = parseInt(req.query?.columnNumber as string, 10)\n\n    if (!filePath) {\n      res.json(emptyResponse)\n      return\n    }\n\n    const sourceContent = await fs.readFile(filePath, `utf-8`)\n\n    const codeFrame = codeFrameColumns(\n      sourceContent,\n      {\n        start: {\n          line: lineNumber,\n          column: columnNumber ?? 0,\n        },\n      },\n      {\n        highlightCode: true,\n      }\n    )\n    res.json({\n      codeFrame,\n    })\n  })\n\n  // Expose access to app for advanced use cases\n  const { developMiddleware } = store.getState().config\n\n  if (developMiddleware) {\n    developMiddleware(app, program)\n  }\n\n  const { proxy, trailingSlash } = store.getState().config\n\n  app.use(configureTrailingSlash(() => store.getState(), trailingSlash))\n\n  // Disable directory indexing i.e. serving index.html from a directory.\n  // This can lead to serving stale html files during development.\n  //\n  // We serve by default an empty index.html that sets up the dev environment.\n  app.use(developStatic(`public`, { index: false }))\n\n  // Set up API proxy.\n  if (proxy) {\n    proxy.forEach(({ prefix, url }) => {\n      app.use(`${prefix}/*`, (req, res) => {\n        const proxiedUrl = url + req.originalUrl\n        const {\n          // remove `host` from copied headers\n          // eslint-disable-next-line @typescript-eslint/no-unused-vars\n          headers: { host, ...headers },\n          method,\n        } = req\n        req\n          .pipe(\n            got\n              .stream(proxiedUrl, {\n                headers,\n                method: method as Method,\n                decompress: false,\n              })\n              .on(`response`, response =>\n                res.writeHead(response.statusCode || 200, response.headers)\n              )\n              .on(`error`, (err, _, response) => {\n                if (response) {\n                  res.writeHead(response.statusCode || 400, response.headers)\n                } else {\n                  const message = `Error when trying to proxy request \"${req.originalUrl}\" to \"${proxiedUrl}\"`\n\n                  report.error(message, err)\n                  res.sendStatus(500)\n                }\n              })\n          )\n          .pipe(res)\n      })\n    }, cors())\n  }\n\n  await apiRunnerNode(`onCreateDevServer`, { app, deferNodeMutation: true })\n\n  // In case nothing before handled hot-update - send 404.\n  // This fixes \"Unexpected token < in JSON at position 0\" runtime\n  // errors after restarting development server and\n  // cause automatic hard refresh in the browser.\n  app.use(/.*\\.hot-update\\.json$/i, (_, res) => {\n    res.status(404).end()\n  })\n\n  // Render an HTML page and serve it.\n  if (process.env.GATSBY_EXPERIMENTAL_DEV_SSR) {\n    app.get(`*`, async (req, res, next) => {\n      telemetry.trackFeatureIsUsed(`GATSBY_EXPERIMENTAL_DEV_SSR`)\n\n      const pathObj = findPageByPath(store.getState(), decodeURI(req.path))\n\n      if (!pathObj) {\n        return next()\n      }\n\n      const allowTimedFallback = !req.headers[`x-gatsby-wait-for-dev-ssr`]\n\n      await appendPreloadHeaders(pathObj.path, res)\n\n      const htmlActivity = report.phantomActivity(`building HTML for path`, {})\n      htmlActivity.start()\n\n      try {\n        const { html: renderResponse, serverData } = await renderDevHTML({\n          path: pathObj.path,\n          page: pathObj,\n          skipSsr: Object.prototype.hasOwnProperty.call(req.query, `skip-ssr`),\n          store,\n          allowTimedFallback,\n          htmlComponentRendererPath: PAGE_RENDERER_PATH,\n          directory: program.directory,\n          req,\n        })\n\n        if (serverData?.headers) {\n          for (const [name, value] of Object.entries(serverData.headers)) {\n            res.setHeader(name, value)\n          }\n        }\n        let statusCode = 200\n        if (serverData?.status) {\n          statusCode = serverData.status\n        }\n        res.status(statusCode).send(renderResponse)\n      } catch (error) {\n        // The page errored but couldn't read the page component.\n        // This is a race condition when a page is deleted but its requested\n        // immediately after before anything can recompile.\n        if (error === `404 page`) {\n          return next()\n        }\n\n        // renderDevHTML throws an error with these information\n        const lineNumber = error?.line as number\n        const columnNumber = error?.column as number\n        const filePath = error?.filename as string\n        const sourceContent = error?.sourceContent as string\n\n        report.error({\n          id: `11614`,\n          context: {\n            path: pathObj.path,\n            filePath: filePath,\n            line: lineNumber,\n            column: columnNumber,\n          },\n        })\n\n        const emptyResponse = {\n          codeFrame: `No codeFrame could be generated`,\n          sourcePosition: null,\n          sourceContent: null,\n        }\n\n        if (!sourceContent || !lineNumber) {\n          res.json(emptyResponse)\n          return null\n        }\n\n        const codeFrame = codeFrameColumns(\n          sourceContent,\n          {\n            start: {\n              line: lineNumber,\n              column: columnNumber ?? 0,\n            },\n          },\n          {\n            highlightCode: true,\n          }\n        )\n\n        const message = {\n          codeFrame,\n          source: filePath,\n          line: lineNumber,\n          column: columnNumber ?? 0,\n          sourceMessage: error?.message,\n          stack: error?.stack,\n        }\n\n        try {\n          // Generate a shell for client-only content -- for the error overlay\n          const { html: clientOnlyShell } = await renderDevHTML({\n            path: pathObj.path,\n            page: pathObj,\n            skipSsr: true,\n            store,\n            error: message,\n            htmlComponentRendererPath: PAGE_RENDERER_PATH,\n            directory: program.directory,\n            req,\n            allowTimedFallback,\n          })\n\n          res.send(clientOnlyShell)\n        } catch (e) {\n          report.error({\n            id: `11616`,\n            context: {\n              sourceMessage: e.message,\n            },\n            filePath: e.filename,\n            location: {\n              start: {\n                line: e.line,\n                column: e.column,\n              },\n            },\n          })\n\n          const minimalHTML = `<head><title>Failed to Server Render (SSR)</title></head><body><h1>Failed to Server Render (SSR)</h1><h2>Error message:</h2><p>${e.message}</p><h2>File:</h2><p>${e.filename}:${e.line}:${e.column}</p><h2>Stack:</h2><pre><code>${e.stack}</code></pre></body>`\n\n          res.send(minimalHTML).status(500)\n        }\n      }\n\n      htmlActivity.end()\n\n      return null\n    })\n  }\n\n  if (\n    process.env.GATSBY_QUERY_ON_DEMAND &&\n    process.env.GATSBY_QUERY_ON_DEMAND_LOADING_INDICATOR === `true`\n  ) {\n    routeLoadingIndicatorRequests(app)\n  }\n\n  app.use(async (req, res) => {\n    // in this catch-all block we don't support POST so we should 404\n    if (req.method === `POST`) {\n      res.status(404).end()\n      return\n    }\n\n    const fullUrl = req.protocol + `://` + req.get(`host`) + req.originalUrl\n    // This isn't used in development.\n    if (fullUrl.endsWith(`app-data.json`)) {\n      res.json({ webpackCompilationHash: `123` })\n      // If this gets here, it's a non-existent file so just send back 404.\n    } else if (fullUrl.endsWith(`.json`)) {\n      res.json({}).status(404)\n    } else {\n      await appendPreloadHeaders(req.path, res)\n\n      if (process.env.GATSBY_EXPERIMENTAL_DEV_SSR) {\n        try {\n          const allowTimedFallback = !req.headers[`x-gatsby-wait-for-dev-ssr`]\n          const { html: renderResponse } = await renderDevHTML({\n            path: `/dev-404-page/`,\n            // Let renderDevHTML figure it out.\n            page: undefined,\n            store,\n            htmlComponentRendererPath: pageRenderer,\n            directory: program.directory,\n            req,\n            allowTimedFallback,\n          })\n          res.status(404).send(renderResponse)\n        } catch (e) {\n          report.error({\n            id: `11615`,\n            context: {\n              sourceMessage: e.message,\n            },\n            filePath: e.filename,\n            location: {\n              start: {\n                line: e.line,\n                column: e.column,\n              },\n            },\n          })\n          res.send(e).status(500)\n        }\n      } else {\n        const potentialPagePath = reverseFixedPagePath(decodeURI(req.path))\n        const page = findPageByPath(store.getState(), potentialPagePath, false)\n\n        // When we can't find a page we send 404\n        if (!page) {\n          res.status(404)\n        }\n\n        res.sendFile(directoryPath(`.cache/develop-html/index.html`), err => {\n          if (err) {\n            res.status(500).end()\n          }\n        })\n      }\n    }\n  })\n\n  /**\n   * Set up the HTTP server and socket.io.\n   **/\n  const server = program.ssl\n    ? new https.Server(program.ssl, app)\n    : new http.Server(app)\n  const socket = websocketManager.init({ server })\n  const listener = server.listen(program.port, program.host)\n\n  if (!process.env.GATSBY_EXPERIMENTAL_DEV_SSR) {\n    const chokidar = require(`chokidar`)\n    // Register watcher that rebuilds index.html every time html.js changes.\n    const watchGlobs = [`src/html.js`, `plugins/**/gatsby-ssr.js`].map(path =>\n      slash(directoryPath(path))\n    )\n\n    chokidar.watch(watchGlobs).on(`change`, async () => {\n      await createIndexHtml(indexHTMLActivity)\n      // eslint-disable-next-line no-unused-expressions\n      socket?.to(`clients`).emit(`reload`)\n    })\n  }\n\n  return {\n    compiler,\n    listener,\n    webpackActivity,\n    websocketManager,\n    workerPool,\n    webpackWatching: webpackDevMiddlewareInstance.context.watching,\n  }\n}\n"],"mappings":"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"}