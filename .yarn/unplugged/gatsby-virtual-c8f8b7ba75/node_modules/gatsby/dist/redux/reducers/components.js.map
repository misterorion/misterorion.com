{"version":3,"file":"components.js","names":["programStatus","componentsReducer","state","Map","action","type","component","get","payload","componentPath","componentChunkName","query","pages","Set","isInBootstrap","serverData","config","isSlice","add","name","set","path","normalize","delete"],"sources":["../../../src/redux/reducers/components.ts"],"sourcesContent":["import normalize from \"../../utils/normalize-path\"\nimport { IGatsbyState, ActionsUnion } from \"../types\"\n\nlet programStatus = `BOOTSTRAPPING`\n\n// TODO: replace usages of this reducer with queries.trackedComponents\n//  It is here merely for compatibility.\nexport const componentsReducer = (\n  state: IGatsbyState[\"components\"] = new Map(),\n  action: ActionsUnion\n): IGatsbyState[\"components\"] => {\n  switch (action.type) {\n    case `CREATE_SLICE`: {\n      let component = state.get(action.payload.componentPath)\n      if (!component) {\n        component = {\n          componentPath: action.payload.componentPath,\n          componentChunkName: action.payload.componentChunkName,\n          query: ``,\n          pages: new Set(),\n          isInBootstrap: true,\n          serverData: false,\n          config: false,\n          isSlice: true,\n        }\n      }\n      component.pages.add(action.payload.name)\n      component.isInBootstrap = programStatus === `BOOTSTRAPPING`\n      state.set(action.payload.componentPath, component)\n      return state\n    }\n    case `DELETE_CACHE`:\n      return new Map()\n    case `SET_PROGRAM_STATUS`:\n      programStatus = action.payload\n      return state\n    case `CREATE_PAGE`: {\n      // Create XState service.\n      let component = state.get(action.payload.componentPath)\n      if (!component) {\n        component = {\n          componentPath: action.payload.componentPath,\n          componentChunkName: action.payload.componentChunkName,\n          query: ``,\n          pages: new Set(),\n          isInBootstrap: true,\n          serverData: false,\n          config: false,\n          isSlice: false,\n        }\n      }\n      component.pages.add(action.payload.path)\n      component.isInBootstrap = programStatus === `BOOTSTRAPPING`\n      state.set(action.payload.componentPath, component)\n      return state\n    }\n    case `QUERY_EXTRACTED`: {\n      action.payload.componentPath = normalize(action.payload.componentPath)\n      const component = state.get(action.payload.componentPath)!\n      component.query = action.payload.query\n      state.set(action.payload.componentPath, component)\n      return state\n    }\n    case `REMOVE_STATIC_QUERIES_BY_TEMPLATE`: {\n      action.payload.componentPath = normalize(action.payload.componentPath)\n      state.delete(action.payload.componentPath)\n      return state\n    }\n    case `SET_COMPONENT_FEATURES`: {\n      const path = normalize(action.payload.componentPath)\n      const component = state.get(path)\n      if (component) {\n        component.serverData = action.payload.serverData\n        component.config = action.payload.config\n      }\n      return state\n    }\n    case `DELETE_PAGE`: {\n      const component = state.get(normalize(action.payload.component))!\n      component.pages.delete(action.payload.path)\n      return state\n    }\n    case `DELETE_SLICE`: {\n      const component = state.get(normalize(action.payload.componentPath))\n      if (component) {\n        component.pages.delete(action.payload.name)\n      }\n      return state\n    }\n  }\n\n  return state\n}\n"],"mappings":"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"}