{"version":3,"file":"babel-plugin-add-slice-placeholder-location.js","names":["addSlicePlaceholderLocation","types","t","name","visitor","JSXOpeningElement","nodePath","get","referencesImport","file","opts","filename","__renderedByLocationProperties","objectProperty","identifier","stringLiteral","relative","store","getState","program","directory","node","loc","start","line","push","numericLiteral","column","end","newProp","jsxAttribute","jsxIdentifier","jsxExpressionContainer","objectExpression","attributes"],"sources":["../../../src/utils/babel/babel-plugin-add-slice-placeholder-location.ts"],"sourcesContent":["import { relative } from \"path\"\nimport type { PluginObj, types as BabelTypes, PluginPass } from \"@babel/core\"\nimport { ObjectProperty } from \"@babel/types\"\nimport { store } from \"../../redux\"\n\n/**\n * This is a plugin that finds Slice placeholder components and injects the __renderedByLocation prop\n * with filename and location in the file where the placeholder was found. This is later used to provide\n * more useful error messages when the user props are invalid showing codeframe where user tries to render it\n * instead of codeframe of the Slice component itself (internals of gatsby) that is not useful for the user.\n */\n\nexport default function addSlicePlaceholderLocation(\n  this: PluginPass,\n  {\n    types: t,\n  }: {\n    types: typeof BabelTypes\n  }\n): PluginObj {\n  return {\n    name: `babel-plugin-add-slice-placeholder-location`,\n    visitor: {\n      JSXOpeningElement(nodePath): void {\n        if (!nodePath.get(`name`).referencesImport(`gatsby`, `Slice`)) {\n          return\n        }\n\n        if (this.file.opts.filename) {\n          const __renderedByLocationProperties: Array<ObjectProperty> = [\n            t.objectProperty(\n              t.identifier(`fileName`),\n              t.stringLiteral(\n                relative(\n                  store.getState().program.directory,\n                  this.file.opts.filename\n                )\n              )\n            ),\n          ]\n\n          if (nodePath.node.loc?.start.line) {\n            __renderedByLocationProperties.push(\n              t.objectProperty(\n                t.identifier(`lineNumber`),\n                t.numericLiteral(nodePath.node.loc.start.line)\n              )\n            )\n\n            if (nodePath.node.loc?.start.column) {\n              __renderedByLocationProperties.push(\n                t.objectProperty(\n                  t.identifier(`columnNumber`),\n                  t.numericLiteral(nodePath.node.loc.start.column + 1)\n                )\n              )\n            }\n\n            if (nodePath.node.loc?.end.line) {\n              __renderedByLocationProperties.push(\n                t.objectProperty(\n                  t.identifier(`endLineNumber`),\n                  t.numericLiteral(nodePath.node.loc.end.line)\n                )\n              )\n\n              if (nodePath.node.loc?.end.column) {\n                __renderedByLocationProperties.push(\n                  t.objectProperty(\n                    t.identifier(`endColumnNumber`),\n                    t.numericLiteral(nodePath.node.loc.end.column + 1)\n                  )\n                )\n              }\n            }\n          }\n\n          const newProp = t.jsxAttribute(\n            t.jsxIdentifier(`__renderedByLocation`),\n            t.jsxExpressionContainer(\n              t.objectExpression(__renderedByLocationProperties)\n            )\n          )\n\n          nodePath.node.attributes.push(newProp)\n        }\n      },\n    },\n  }\n}\n"],"mappings":";;;;;AAAA;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;AAEe,SAASA,2BAAT,CAEb;EACEC,KAAK,EAAEC;AADT,CAFa,EAOF;EACX,OAAO;IACLC,IAAI,EAAG,6CADF;IAELC,OAAO,EAAE;MACPC,iBAAiB,CAACC,QAAD,EAAiB;QAChC,IAAI,CAACA,QAAQ,CAACC,GAAT,CAAc,MAAd,EAAqBC,gBAArB,CAAuC,QAAvC,EAAiD,OAAjD,CAAL,EAA+D;UAC7D;QACD;;QAED,IAAI,KAAKC,IAAL,CAAUC,IAAV,CAAeC,QAAnB,EAA6B;UAAA;;UAC3B,MAAMC,8BAAqD,GAAG,CAC5DV,CAAC,CAACW,cAAF,CACEX,CAAC,CAACY,UAAF,CAAc,UAAd,CADF,EAEEZ,CAAC,CAACa,aAAF,CACE,IAAAC,cAAA,EACEC,YAAA,CAAMC,QAAN,GAAiBC,OAAjB,CAAyBC,SAD3B,EAEE,KAAKX,IAAL,CAAUC,IAAV,CAAeC,QAFjB,CADF,CAFF,CAD4D,CAA9D;;UAYA,0BAAIL,QAAQ,CAACe,IAAT,CAAcC,GAAlB,+CAAI,mBAAmBC,KAAnB,CAAyBC,IAA7B,EAAmC;YAAA;;YACjCZ,8BAA8B,CAACa,IAA/B,CACEvB,CAAC,CAACW,cAAF,CACEX,CAAC,CAACY,UAAF,CAAc,YAAd,CADF,EAEEZ,CAAC,CAACwB,cAAF,CAAiBpB,QAAQ,CAACe,IAAT,CAAcC,GAAd,CAAkBC,KAAlB,CAAwBC,IAAzC,CAFF,CADF;;YAOA,2BAAIlB,QAAQ,CAACe,IAAT,CAAcC,GAAlB,gDAAI,oBAAmBC,KAAnB,CAAyBI,MAA7B,EAAqC;cACnCf,8BAA8B,CAACa,IAA/B,CACEvB,CAAC,CAACW,cAAF,CACEX,CAAC,CAACY,UAAF,CAAc,cAAd,CADF,EAEEZ,CAAC,CAACwB,cAAF,CAAiBpB,QAAQ,CAACe,IAAT,CAAcC,GAAd,CAAkBC,KAAlB,CAAwBI,MAAxB,GAAiC,CAAlD,CAFF,CADF;YAMD;;YAED,2BAAIrB,QAAQ,CAACe,IAAT,CAAcC,GAAlB,gDAAI,oBAAmBM,GAAnB,CAAuBJ,IAA3B,EAAiC;cAAA;;cAC/BZ,8BAA8B,CAACa,IAA/B,CACEvB,CAAC,CAACW,cAAF,CACEX,CAAC,CAACY,UAAF,CAAc,eAAd,CADF,EAEEZ,CAAC,CAACwB,cAAF,CAAiBpB,QAAQ,CAACe,IAAT,CAAcC,GAAd,CAAkBM,GAAlB,CAAsBJ,IAAvC,CAFF,CADF;;cAOA,2BAAIlB,QAAQ,CAACe,IAAT,CAAcC,GAAlB,gDAAI,oBAAmBM,GAAnB,CAAuBD,MAA3B,EAAmC;gBACjCf,8BAA8B,CAACa,IAA/B,CACEvB,CAAC,CAACW,cAAF,CACEX,CAAC,CAACY,UAAF,CAAc,iBAAd,CADF,EAEEZ,CAAC,CAACwB,cAAF,CAAiBpB,QAAQ,CAACe,IAAT,CAAcC,GAAd,CAAkBM,GAAlB,CAAsBD,MAAtB,GAA+B,CAAhD,CAFF,CADF;cAMD;YACF;UACF;;UAED,MAAME,OAAO,GAAG3B,CAAC,CAAC4B,YAAF,CACd5B,CAAC,CAAC6B,aAAF,CAAiB,sBAAjB,CADc,EAEd7B,CAAC,CAAC8B,sBAAF,CACE9B,CAAC,CAAC+B,gBAAF,CAAmBrB,8BAAnB,CADF,CAFc,CAAhB;UAOAN,QAAQ,CAACe,IAAT,CAAca,UAAd,CAAyBT,IAAzB,CAA8BI,OAA9B;QACD;MACF;;IAhEM;EAFJ,CAAP;AAqED"}