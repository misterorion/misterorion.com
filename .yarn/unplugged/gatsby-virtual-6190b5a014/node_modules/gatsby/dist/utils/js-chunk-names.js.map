{"version":3,"file":"js-chunk-names.js","names":["kebabCase","memoize","pathRelative","path","relative","murmurhash","_murmurhash","replaceUnifiedRoutesKeys","kebabedName","filePath","newString","split","sep","forEach","part","match","exec","replace","chunkNameCache","Map","generateComponentChunkName","componentPath","kind","has","get","program","store","getState","directory","name","maxLength","shouldTruncate","length","hash","substring","chunkName","set"],"sources":["../../src/utils/js-chunk-names.ts"],"sourcesContent":["import memoize from \"memoizee\"\nimport { kebabCase as _kebabCase } from \"lodash\"\nimport { murmurhash as _murmurhash } from \"gatsby-core-utils/murmurhash\"\nimport path from \"path\"\nimport { store } from \"../redux\"\n\nconst kebabCase: (string?: string) => string = memoize(_kebabCase)\nconst pathRelative: (from: string, to: string) => string = memoize(\n  path.relative\n)\nconst murmurhash: (str: string, seed: number) => number = memoize(_murmurhash)\n\n// unified routes adds support for files with [] and {},\n// the problem with our generateComponentChunkName is that when you\n// call kebabCase, is strips off characters like that. This means\n// that when you have a app with this sort of setup, the resolutions fail\n//\n// src/pages/products/{id}.js (collection route)\n// src/pages/products/[...id].js (should render when a non-matched id is passed in)\n//\n// without this function, what happens is that all visits to /products/__ resolve to only one\n// of these because the componentChunkName ends up being duplicate. This function ensures that\n// the {} and [] are kept in the componentChunkName. Also there are tests for this.\nfunction replaceUnifiedRoutesKeys(\n  kebabedName: string,\n  filePath: string\n): string {\n  let newString = kebabedName\n\n  filePath.split(path.sep).forEach(part => {\n    if (part[0] === `[` || part[0] === `{`) {\n      const match = /(\\[(.*)\\]|\\{(.*)\\})/.exec(part)\n      newString = newString.replace(\n        `-${match![2] || match![3]}-`,\n        `-${match![0]}-`\n      )\n    }\n  })\n\n  return newString\n}\n\nconst chunkNameCache = new Map()\nexport function generateComponentChunkName(\n  componentPath: string,\n  kind: \"component\" | \"slice\" = `component`\n): string {\n  if (chunkNameCache.has(componentPath)) {\n    return chunkNameCache.get(componentPath)\n  } else {\n    const { program } = store.getState()\n    const directory = program?.directory || `/`\n    let name = pathRelative(directory, componentPath)\n    name = replaceUnifiedRoutesKeys(kebabCase(name), name)\n\n    /**\n     * File names should not exceed 255 characters\n     * minus 12 for `component---`\n     * minus 7 for `.js.map`\n     * minus 20 for `-[hash].js`\n     */\n    const maxLength = 215\n    const shouldTruncate = name.length > maxLength\n\n    /**\n     * To prevent long file name errors, we truncate the name to a maximum of 60 characters.\n     */\n    if (shouldTruncate) {\n      const hash = murmurhash(name, 0)\n      name = `${hash}-${name.substring(name.length - 60)}`\n    }\n\n    const chunkName = `${kind}---${name}`\n\n    chunkNameCache.set(componentPath, chunkName)\n\n    return chunkName\n  }\n}\n"],"mappings":";;;;;;;;;AAAA;;AAEA;;AACA;;AACA;;AAEA,MAAMA,SAAsC,GAAG,IAAAC,iBAAA,sBAA/C;AACA,MAAMC,YAAkD,GAAG,IAAAD,iBAAA,EACzDE,aAAA,CAAKC,QADoD,CAA3D;AAGA,MAAMC,UAAiD,GAAG,IAAAJ,iBAAA,EAAQK,uBAAR,CAA1D,C,CAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,SAASC,wBAAT,CACEC,WADF,EAEEC,QAFF,EAGU;EACR,IAAIC,SAAS,GAAGF,WAAhB;EAEAC,QAAQ,CAACE,KAAT,CAAeR,aAAA,CAAKS,GAApB,EAAyBC,OAAzB,CAAiCC,IAAI,IAAI;IACvC,IAAIA,IAAI,CAAC,CAAD,CAAJ,KAAa,GAAb,IAAmBA,IAAI,CAAC,CAAD,CAAJ,KAAa,GAApC,EAAwC;MACtC,MAAMC,KAAK,GAAG,sBAAsBC,IAAtB,CAA2BF,IAA3B,CAAd;MACAJ,SAAS,GAAGA,SAAS,CAACO,OAAV,CACT,IAAGF,KAAK,CAAE,CAAF,CAAL,IAAaA,KAAK,CAAE,CAAF,CAAK,GADjB,EAET,IAAGA,KAAK,CAAE,CAAF,CAAK,GAFJ,CAAZ;IAID;EACF,CARD;EAUA,OAAOL,SAAP;AACD;;AAED,MAAMQ,cAAc,GAAG,IAAIC,GAAJ,EAAvB;;AACO,SAASC,0BAAT,CACLC,aADK,EAELC,IAA2B,GAAI,WAF1B,EAGG;EACR,IAAIJ,cAAc,CAACK,GAAf,CAAmBF,aAAnB,CAAJ,EAAuC;IACrC,OAAOH,cAAc,CAACM,GAAf,CAAmBH,aAAnB,CAAP;EACD,CAFD,MAEO;IACL,MAAM;MAAEI;IAAF,IAAcC,YAAA,CAAMC,QAAN,EAApB;;IACA,MAAMC,SAAS,GAAG,CAAAH,OAAO,SAAP,IAAAA,OAAO,WAAP,YAAAA,OAAO,CAAEG,SAAT,KAAuB,GAAzC;IACA,IAAIC,IAAI,GAAG3B,YAAY,CAAC0B,SAAD,EAAYP,aAAZ,CAAvB;IACAQ,IAAI,GAAGtB,wBAAwB,CAACP,SAAS,CAAC6B,IAAD,CAAV,EAAkBA,IAAlB,CAA/B;IAEA;AACJ;AACA;AACA;AACA;AACA;;IACI,MAAMC,SAAS,GAAG,GAAlB;IACA,MAAMC,cAAc,GAAGF,IAAI,CAACG,MAAL,GAAcF,SAArC;IAEA;AACJ;AACA;;IACI,IAAIC,cAAJ,EAAoB;MAClB,MAAME,IAAI,GAAG5B,UAAU,CAACwB,IAAD,EAAO,CAAP,CAAvB;MACAA,IAAI,GAAI,GAAEI,IAAK,IAAGJ,IAAI,CAACK,SAAL,CAAeL,IAAI,CAACG,MAAL,GAAc,EAA7B,CAAiC,EAAnD;IACD;;IAED,MAAMG,SAAS,GAAI,GAAEb,IAAK,MAAKO,IAAK,EAApC;IAEAX,cAAc,CAACkB,GAAf,CAAmBf,aAAnB,EAAkCc,SAAlC;IAEA,OAAOA,SAAP;EACD;AACF"}