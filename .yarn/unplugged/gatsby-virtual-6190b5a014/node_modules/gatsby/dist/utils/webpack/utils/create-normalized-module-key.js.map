{"version":3,"file":"create-normalized-module-key.js","names":["createNormalizedModuleKey","resourcePath","rootContext","rootRelativeFilePath","replace","rootRelativeDir","potentialModuleName","split","path","sep","filter","Boolean","normalizedModuleKey","join","slice","slash"],"sources":["../../../../src/utils/webpack/utils/create-normalized-module-key.ts"],"sourcesContent":["import path from \"path\"\nimport { slash } from \"gatsby-core-utils\"\n\n/**\n * Create a normalized module key that is referenced in both the partial hydration webpack loader and plugin.\n * This solves for module imports that may be differently bundled for different environments (e.g. browser, node).\n *\n * If the module is a local module, the key is the relative path from the project root (e.g. `file://src/components/index.js`).\n * If the module is a node module, the key is the relative path to the module name in `node_modules` (e.g. `file://node_modules/react`).\n *\n * @param resourcePath Absolute path to the resource\n * @param rootContext Absolute path to project root\n * @returns Normalized module key\n */\nexport function createNormalizedModuleKey(\n  resourcePath: string,\n  rootContext: string\n): string {\n  const rootRelativeFilePath = resourcePath.replace(rootContext, ``)\n  const [rootRelativeDir, potentialModuleName] = rootRelativeFilePath\n    .split(path.sep)\n    .filter(Boolean)\n  const normalizedModuleKey =\n    rootRelativeDir === `node_modules`\n      ? `file://${path.join(rootRelativeDir, potentialModuleName)}`\n      : `file://${rootRelativeFilePath.slice(1)}`\n  return slash(normalizedModuleKey)\n}\n"],"mappings":";;;;;;;AAAA;;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASA,yBAAT,CACLC,YADK,EAELC,WAFK,EAGG;EACR,MAAMC,oBAAoB,GAAGF,YAAY,CAACG,OAAb,CAAqBF,WAArB,EAAmC,EAAnC,CAA7B;EACA,MAAM,CAACG,eAAD,EAAkBC,mBAAlB,IAAyCH,oBAAoB,CAChEI,KAD4C,CACtCC,aAAA,CAAKC,GADiC,EAE5CC,MAF4C,CAErCC,OAFqC,CAA/C;EAGA,MAAMC,mBAAmB,GACvBP,eAAe,KAAM,cAArB,GACK,UAASG,aAAA,CAAKK,IAAL,CAAUR,eAAV,EAA2BC,mBAA3B,CAAgD,EAD9D,GAEK,UAASH,oBAAoB,CAACW,KAArB,CAA2B,CAA3B,CAA8B,EAH9C;EAIA,OAAO,IAAAC,sBAAA,EAAMH,mBAAN,CAAP;AACD"}